<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script>
        const APP_VERSION = '2.0.4'; // Increment this with each deploy
        const cachedVersion = localStorage.getItem('appVersion');

        if (cachedVersion && cachedVersion !== APP_VERSION) {
        console.log('New version detected, clearing cache...');
        
        // Clear all caches
        if ('caches' in window) {
            caches.keys().then(names => {
            names.forEach(name => caches.delete(name));
            });
        }
        
        // Unregister service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
            registrations.forEach(registration => registration.unregister());
            });
        }
        
        localStorage.setItem('appVersion', APP_VERSION);
        window.location.reload(true);
        }

        localStorage.setItem('appVersion', APP_VERSION);
    </script>
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#b66dff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WorkFlow">
    <link rel="apple-touch-icon" href="/icons/icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #b66dff;
            --primary-dark: #9946e6;
            --secondary: #00d25b;
            --warning: #ffab00;
            --danger: #fc424a;
            --info: #00d0ff;
            --dark: #191c24;
            --darker: #0f1015;
            --card-bg: #1f2128;
            --border-color: #2c2e33;
            --text-primary: #ffffff;
            --text-secondary: #adb5bd;
            --text-muted: #6c757d;
        }

        body.light-theme {
            --dark: #f5f7fa;
            --darker: #ffffff;
            --card-bg: #ffffff;
            --border-color: #e0e6ed;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --text-muted: #9ca3af;
        }

        body.midnight-theme {
            --dark: #0a0e27;
            --darker: #050816;
            --card-bg: #0f1729;
            --border-color: #1a1f3a;
            --primary: #a78bfa;
            --secondary: #34d399;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 255px;
            height: 100vh;
            background: var(--darker);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            z-index: 100;
            transition: all 0.3s;
        }

        .sidebar-brand {
            padding: 1.5rem 1.875rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-brand-icon {
            font-size: 2rem;
            display: flex;
            align-items: center;
            color: var(--primary);
        }

        .sidebar-brand-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffab00;
        }

        .sidebar-menu {
            padding: 1.5rem 0;
        }

        .sidebar-menu-item {
            padding: 0.75rem 1.875rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .sidebar-menu-item:hover {
            color: var(--text-primary);
            background: rgba(182, 109, 255, 0.1);
        }

        .sidebar-menu-item.active {
            color: var(--text-primary);
            background: rgba(182, 109, 255, 0.1);
            border-left-color: var(--primary);
        }

        .sidebar-menu-icon {
            font-size: 1.2rem;
            width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-panel {
            margin-left: 255px;
            min-height: 100vh;
            background: var(--dark);
            transition: all 0.3s;
        }

        .navbar {
            background: var(--card-bg);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .navbar-left {
            display: flex;
            align-items: center;
        }

        .navbar-left h4 {
            font-weight: 500;
            color: var(--text-primary);
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary);
        }

        .user-name {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .badge {
            background: var(--secondary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .content-wrapper {
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h3 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .breadcrumb {
            display: flex;
            gap: 0.5rem;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(182, 109, 255, 0.15);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-info h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.05); /* Default background */
        }

        .stat-card.primary { border-left-color: var(--primary); }
        .stat-card.primary .stat-icon {
            background: rgba(182, 109, 255, 0.2);
            color: var(--primary);
        }

        .stat-card.success { border-left-color: var(--secondary); }
        .stat-card.success .stat-icon {
            background: rgba(0, 210, 91, 0.2);
            color: var(--secondary);
        }

        .stat-card.warning { border-left-color: var(--warning); }
        .stat-card.warning .stat-icon {
            background: rgba(255, 171, 0, 0.2);
            color: var(--warning);
        }

        .stat-card.danger { border-left-color: var(--danger); }
        .stat-card.danger .stat-icon {
            background: rgba(252, 66, 74, 0.2);
            color: var(--danger);
        }

        .stat-card.info { border-left-color: var(--info); }
        .stat-card.info .stat-icon {
            background: rgba(0, 208, 255, 0.2);
            color: var(--info);
        }

        .stat-card.streak { border-left-color: #ff5722; }
        .stat-card.streak .stat-icon {
            background: rgba(255, 87, 34, 0.2);
            color: #ff5722;
        }

        .assignments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .assignment-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--primary);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .assignment-card:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 30px rgba(182, 109, 255, 0.2);
        }

        .assignment-badge {
            background: rgba(182, 109, 255, 0.2);
            color: var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .assignment-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 1rem 0 0.5rem;
            color: var(--text-primary);
        }

        .assignment-course {
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
        }

        .assignment-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .assignment-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .assignment-status.pending {
            background: rgba(255, 171, 0, 0.2);
            color: var(--warning);
        }

        .assignment-status.late {
            background: rgba(252, 66, 74, 0.2);
            color: var(--danger);
        }

        .btn {
            padding: 0.875rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #e63946;
        }

        .btn-google {
            background: white;
            color: #333;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-google:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
        }

        .auth-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: var(--dark);
            padding: 2rem;
        }

        .auth-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 3rem;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .auth-card h2 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .auth-card p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .notification-permission {
            background: rgba(255, 171, 0, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .time-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: rgba(182, 109, 255, 0.05);
            padding: 0.5rem;
            border-radius: 8px;
        }

        .time-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .time-btn.active {
            background: var(--primary);
            color: white;
        }

        .time-btn:hover:not(.active) {
            background: rgba(182, 109, 255, 0.1);
            color: var(--text-primary);
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            display: flex;
            gap: 1rem;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .chat-content {
            background: rgba(182, 109, 255, 0.1);
            padding: 1rem;
            border-radius: 12px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .chat-message.user .chat-content {
            background: var(--primary);
            color: white;
        }

        .chat-input-container {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
        }

        .chat-input {
            flex: 1;
            background: var(--dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            resize: none;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--text-secondary);
        }

        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--text-secondary);
        }

        .error {
            background: rgba(252, 66, 74, 0.1);
            color: var(--danger);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--danger);
        }
        
        .menu-toggle {
            display: none;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding-right: 1rem;
        }

        .sidebar-section-label {
            padding: 1.5rem 1.875rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 90;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .sidebar-backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        /* Accordion Styles */
        .accordion-item {
            background: rgba(182, 109, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            overflow: hidden;
            transition: all 0.3s;
        }

        .accordion-item:hover {
            border-color: rgba(182, 109, 255, 0.3);
        }

        .accordion-header {
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--text-primary);
        }

        .accordion-header:hover {
            background: rgba(182, 109, 255, 0.1);
        }

        .accordion-icon {
            transition: transform 0.3s;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .accordion-content {
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease-out;
            color: var(--text-secondary);
            border-top: 1px solid transparent;
        }

        .accordion-item.active {
            border-color: var(--primary);
            background: var(--card-bg);
        }

        .accordion-item.active .accordion-header {
            color: var(--primary);
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-item.active .accordion-content {
            padding: 1rem 1.5rem;
            max-height: 500px; /* Arbitrary large height */
            border-top-color: var(--border-color);
        }

        .unscheduled-assignment:active {
            cursor: grabbing;
            opacity: 0.7;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--darker);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Schedule Card Layout */
        #unscheduledCard {
            padding: 0;
            display: flex;
            flex-direction: column;
            max-height: 600px;
            overflow: hidden;
        }
        #unscheduledHeader {
            padding: 1.5rem;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            z-index: 10;
        }
        #unscheduledList {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        /* Schedule Page Layout */
        .schedule-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-header-cell {
            background: var(--card-bg);
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .calendar-day {
            background: var(--card-bg);
            min-height: 120px;
            padding: 0.5rem;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            transition: background 0.2s;
            min-width: 0; /* Fix grid overflow */
        }

        .mobile-day-label {
            display: none;
            font-weight: 600;
            color: var(--text-secondary);
            margin-right: 0.5rem;
        }

        /* Event Truncation & Fade */
        .schedule-event {
            position: relative;
            overflow: hidden;
            white-space: nowrap;
            /* Fade effect for right side */
            mask-image: linear-gradient(to right, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
        }

        @media (max-width: 991px) {
            .schedule-container {
                grid-template-columns: 200px 1fr;
                gap: 1rem;
            }
            
            /* Compact sidebar items on tablet */
            .unscheduled-assignment {
                padding: 0.75rem;
            }
            .unscheduled-assignment .assignment-course {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 768px) {
            .schedule-container {
                grid-template-columns: 100px 1fr;
                gap: 0.5rem;
            }

            /* Ultra-compact sidebar for mobile */
            #unscheduledHeader {
                padding: 1rem 0.5rem;
            }
            #unscheduledHeader .card-title {
                font-size: 0.875rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            #unscheduledHeader i {
                margin: 0 0 0.25rem 0 !important;
            }
            #unscheduledList {
                padding: 0.5rem;
            }

            .unscheduled-assignment {
                padding: 0.5rem;
                text-align: center;
                border-left-width: 2px !important;
            }

            .unscheduled-assignment .assignment-title {
                font-size: 0.75rem;
                margin-bottom: 0;
                white-space: normal;
                line-height: 1.2;
                max-height: 2.4em;
                overflow: hidden;
            }

            .unscheduled-assignment .assignment-course,
            .unscheduled-assignment .assignment-meta,
            .unscheduled-assignment i {
                display: none;
            }

            /* Calendar List View */
            .calendar-grid {
                grid-template-columns: 1fr;
            }
            .calendar-header-cell {
                display: none;
            }
            .calendar-day {
                min-height: auto;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                flex-direction: column;
            }
            .calendar-day-header-wrapper {
                display: flex;
                align-items: center;
                margin-bottom: 0.5rem;
            }
            .mobile-day-label {
                display: inline-block;
            }
        }

        @media (max-width: 991px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-panel {
                margin-left: 0;
            }
            .assignments-grid {
                grid-template-columns: 1fr;
            }
            .sidebar.sidebar-open {
                transform: translateX(0);
            }
            .menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="auth-page" id="loginPage">
        <div class="auth-card">
            <div class="sidebar-brand-icon" style="justify-content: center; margin-bottom: 1rem;">
                <img src="/icons/icon-192x192.png" alt="WorkFlow Logo" style="width: 60px; height: 60px;">
            </div>
            <h2>WorkFlow</h2>
            <p>Track Google Classroom assignments with AI assistance & productivity insights</p>
            
            <button class="btn btn-google" id="googleLoginBtn">
                <svg width="20" height="20" viewBox="0 0 20 20">
                    <path fill="#4285f4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"/>
                    <path fill="#34a853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"/>
                    <path fill="#fbbc05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"/>
                    <path fill="#ea4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"/>
                </svg>
                Sign in with Google Classroom
            </button>
            
            <div id="errorMsg" class="error" style="display: none; margin-top: 1rem;"></div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" style="display: none;">
        <div class="sidebar-backdrop" id="mobileBackdrop"></div>
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-brand">
                <span class="sidebar-brand-icon">
                    <img src="/icons/icon-192x192.png" alt="Logo" style="width: 32px; height: 32px;">
                </span>
                <span class="sidebar-brand-text">WorkFlow</span>
            </div>
            <div class="sidebar-menu">
                <a class="sidebar-menu-item active" onclick="showPage('assignments')">
                    <span class="sidebar-menu-icon"><i class="ph ph-clipboard-text"></i></span>
                    <span>Assignments</span>
                </a>
                <a class="sidebar-menu-item" onclick="showPage('statistics')">
                    <span class="sidebar-menu-icon"><i class="ph ph-chart-bar"></i></span>
                    <span>Statistics</span>
                </a>
                <a class="sidebar-menu-item" onclick="showPage('aiAssistant')">
                    <span class="sidebar-menu-icon"><i class="ph ph-magic-wand"></i></span>
                    <span>AI Assistant</span>
                </a>
                <a class="sidebar-menu-item" onclick="showPage('schedule')">
                    <span class="sidebar-menu-icon"><i class="ph ph-calendar-blank"></i></span>
                    <span>Schedule Editor</span>
                </a>

                <div class="sidebar-section-label">Preferences</div>

                <a class="sidebar-menu-item" onclick="showPage('courses')">
                    <span class="sidebar-menu-icon"><i class="ph ph-books"></i></span>
                    <span>Courses</span>
                </a>
                <a class="sidebar-menu-item" onclick="showPage('settings')">
                    <span class="sidebar-menu-icon"><i class="ph ph-gear"></i></span>
                    <span>Settings</span>
                </a>

                <div class="sidebar-section-label">Help</div>

                <a class="sidebar-menu-item" onclick="showPage('help')">
                    <span class="sidebar-menu-icon"><i class="ph ph-question"></i></span>
                    <span>FAQ</span>
                </a>
            </div>
        </nav>

        <!-- Main Panel -->
        <div class="main-panel">
            <!-- Navbar -->
            <div class="navbar">
                <div class="navbar-left">
                    <button class="menu-toggle" id="mobileMenuBtn">â˜°</button>
                    <h4>Dashboard</h4>
                </div>
                <div class="navbar-right">
                    <div class="user-profile">
                        <div class="user-avatar"></div>
                        <div>
                            <div class="user-name">User</div>
                            <div class="badge">Connected</div>
                        </div>
                    </div>
                    <button class="btn btn-danger" id="logoutBtn" style="padding: 0.5rem 1rem;">Logout</button>
                </div>
            </div>

            <!-- Content -->
            <div class="content-wrapper">
                <!-- Assignments Page -->
                <div id="assignmentsPage">
                    <div id="notificationPermission" class="notification-permission" style="display: none;">
                        <div style="font-size: 1.5rem; color: var(--warning); display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                            <i class="ph ph-bell-ringing"></i>
                        </div>
                        <div style="flex: 1;">
                            <strong>Enable Notifications</strong>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0.25rem 0 0;">
                                Get comedic reminders when assignments are due soon!
                            </p>
                        </div>
                        <button class="btn btn-primary" onclick="requestNotificationPermission()">Enable</button>
                    </div>

                    <div class="page-header">
                        <h3>My Assignments</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Assignments</span>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <div class="stat-info">
                                <h3 id="totalCount">0</h3>
                                <div class="stat-label">Total Assignments</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-stack"></i></div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-info">
                                <h3 id="pendingCount">0</h3>
                                <div class="stat-label">Pending</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-hourglass"></i></div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-info">
                                <h3 id="lateCount">0</h3>
                                <div class="stat-label">Late</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-warning-circle"></i></div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-info">
                                <h3 id="dueToday">0</h3>
                                <div class="stat-label">Due Today</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-target"></i></div>
                        </div>
                    </div>

                    <div id="loadingMsg" class="loading" style="display: none;">
                        Loading assignments...
                    </div>

                    <div class="assignments-grid" id="assignmentsList"></div>
                </div>

                <!-- Statistics Page -->
                <div id="statisticsPage" style="display: none;">
                    <div class="page-header">
                        <h3>Statistics & Analytics</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Statistics</span>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card warning">
                            <div class="stat-info">
                                <h3 id="upcomingWeek">0</h3>
                                <div class="stat-label">Due This Week</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-calendar"></i></div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-info">
                                <h3 id="overdueTotal">0</h3>
                                <div class="stat-label">Total Overdue</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-siren"></i></div>
                        </div>
                        <div class="stat-card primary">
                            <div class="stat-info">
                                <h3 id="totalCourses">0</h3>
                                <div class="stat-label">Active Courses</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-books"></i></div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-info">
                                <h3 id="avgPerCourse">0</h3>
                                <div class="stat-label">Avg per Course</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-chart-line"></i></div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card" id="statusChartCard">
                            <div class="card-title">Assignment Status Distribution</div>
                            <canvas id="statusChart" style="max-height: 300px;"></canvas>
                        </div>

                        <div class="card" id="courseChartCard">
                            <div class="card-title">Assignments by Course</div>
                            <canvas id="courseChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title"><i class="ph ph-calendar-check" style="margin-right: 0.5rem; color: var(--primary);"></i>Upcoming Deadlines (Next 7 Days)</div>
                        <div id="upcomingDeadlines" style="margin-top: 1rem;"></div>
                    </div>

                    <div class="page-header" style="margin-top: 3rem;">
                        <h3><i class="ph ph-trend-up" style="margin-right: 0.5rem; color: var(--primary);"></i>Your Productivity</h3>
                        <p style="color: var(--text-secondary);">Track your assignment completion over time</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-info">
                                <h3 id="completedToday">0</h3>
                                <div class="stat-label">Completed Today</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-check-circle"></i></div>
                        </div>
                        <div class="stat-card streak">
                            <div class="stat-info">
                                <h3 id="currentStreak">0</h3>
                                <div class="stat-label">Day Streak</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-fire"></i></div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-info">
                                <h3 id="weeklyAvg">0</h3>
                                <div class="stat-label">Weekly Average</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-chart-bar"></i></div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-info">
                                <h3 id="totalCompleted">0</h3>
                                <div class="stat-label">Total Completed</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-trophy"></i></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title"><i class="ph ph-chart-line-up" style="margin-right: 0.5rem; color: var(--primary);"></i>Productivity Trends</div>
                        <div class="time-selector">
                            <button class="time-btn active" onclick="changeProductivityView('today')" data-view="today">Today</button>
                            <button class="time-btn" onclick="changeProductivityView('week')" data-view="week">7 Days</button>
                            <button class="time-btn" onclick="changeProductivityView('month')" data-view="month">30 Days</button>
                        </div>
                        <canvas id="productivityChart" style="max-height: 350px;"></canvas>
                    </div>
                </div>

                <!-- AI Assistant Page -->
                <div id="aiAssistantPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-magic-wand" style="margin-right: 0.5rem; color: var(--primary);"></i>AI Study Assistant</h3>
                        <p style="color: var(--text-secondary);">
                            Chat with AI about your assignments, get study tips, and manage your workload better!
                        </p>
                    </div>

                    <div id="chatInterface" style="display: none;">
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <div class="chat-message">
                                    <div class="chat-avatar">
                                        <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" version="1.1" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="width: 24px; height: 24px;">
                                            <rect height="7.5" width="12.5" y="5.75" x="1.75"></rect> 
                                            <path d="m10.75 8.75v1.5m-5.5-1.5v1.5m-.5-7.5 3.25 3 3.25-3"></path> 
                                        </svg>
                                    </div>
                                    <div class="chat-content">
                                        Hi! I'm your AI study assistant. I can see you have <strong id="aiPendingCount">0</strong> pending assignments. How can I help you today?
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <textarea id="chatInput" class="chat-input" rows="2" placeholder="Ask me anything about your assignments..."></textarea>
                                <button class="btn btn-primary" onclick="sendChatMessage()" style="padding: 1rem 1.5rem;">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Schedule Editor Page -->
                <div id="schedulePage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-calendar-blank" style="margin-right: 0.5rem; color: var(--primary);"></i>Schedule Editor</h3>
                        <p style="color: var(--text-secondary);">Drag assignments to schedule them, then export to your calendar app</p>
                    </div>

                    <div class="schedule-container">
                        <!-- Unscheduled Assignments Sidebar -->
                        <div class="card" id="unscheduledCard">
                            <div class="card-title" id="unscheduledHeader">
                                <div style="display: flex; align-items: center;">
                                    <i class="ph ph-list" style="margin-right: 0.5rem;"></i>
                                    Pending Assignments
                                </div>
                            </div>
                            <div id="unscheduledList"></div>
                        </div>

                        <!-- Calendar View -->
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <div class="card-title" style="margin: 0;">
                                    <i class="ph ph-calendar" style="margin-right: 0.5rem;"></i>
                                    Calendar
                                </div>
                                <button class="btn btn-primary" onclick="exportToICS()">
                                    <i class="ph ph-download"></i> Export to .ics
                                </button>
                            </div>
                            <div id="scheduleCalendar"></div>
                        </div>
                    </div>

                    <div class="card" style="background: rgba(182, 109, 255, 0.1); border-color: var(--primary);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 2rem; color: var(--primary);">
                                <i class="ph ph-info"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">How to use</div>
                                <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                                    <li>Drag assignments from the left panel onto calendar days</li>
                                    <li>Click on scheduled events to edit time and alerts</li>
                                    <li>Use "Auto-Schedule All" to automatically place assignments on their due dates</li>
                                    <li>Export to .ics file to import into Apple Calendar, Google Calendar, or Outlook</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Help & FAQ Page -->
                <div id="helpPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-question" style="margin-right: 0.5rem; color: var(--primary);"></i>Help & FAQ</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Help</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Frequently Asked Questions</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Find answers to common questions below.</p>
                        
                        <!-- Accordion -->
                        <div class="accordion">
                            <div class="accordion-item">
                                <div class="accordion-header" onclick="toggleAccordion(this)">
                                    <span>Cannot install app</span>
                                    <i class="ph ph-caret-down accordion-icon"></i>
                                </div>
                                <div class="accordion-content">
                                    <p style="margin-bottom: 1rem;">
                                        Apple's iOS security policies restrict the installation of Progressive Web Apps (PWAs) from third-party browsers. This feature is fully supported on Android and desktop Chrome, but requires specific steps on iOS.
                                    </p>
                                    <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Solutions:</h5>
                                    <ul style="padding-left: 1.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                                        <li>
                                            <strong>Use Safari:</strong> Open this page in Safari, tap the <strong>Share</strong> button (square with arrow), and select <strong>"Add to Home Screen"</strong>.
                                        </li>
                                        <li>
                                            <strong>Continue in Browser:</strong> You can continue using the application directly within your current web browser without installing it.
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <div class="accordion-header" onclick="toggleAccordion(this)">
                                    <span>Notifications not working on iOS</span>
                                    <i class="ph ph-caret-down accordion-icon"></i>
                                </div>
                                <div class="accordion-content">
                                    <p style="margin-bottom: 1rem;">
                                        On iOS (iPhone/iPad), Push Notifications are only supported if:
                                    </p>
                                    <ul style="padding-left: 1.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                                        <li>
                                            Your device is running <strong>iOS 16.4 or later</strong>.
                                        </li>
                                        <li>
                                            You have added this app to your <strong>Home Screen</strong> (Share > Add to Home Screen).
                                        </li>
                                        <li>
                                            Notifications do not work if you are just viewing the website in Safari without installing it.
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <div class="accordion-header" onclick="toggleAccordion(this)">
                                    <span>Notifications not working on Android</span>
                                    <i class="ph ph-caret-down accordion-icon"></i>
                                </div>
                                <div class="accordion-content">
                                    <p>
                                        Some older Android devices or specific manufacturers (like Xiaomi, Huawei) have aggressive battery optimization that kills background processes.
                                    </p>
                                    <p style="margin-top: 0.5rem;">
                                        Ensure "WorkFlow" is allowed to run in the background in your Battery Settings.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Courses Page -->
                <div id="coursesPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-books" style="margin-right: 0.5rem; color: var(--primary);"></i>My Courses</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Courses</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">Manage Your Courses</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Uncheck courses you want to ignore. They won't appear in assignments or statistics.</p>
                        <div id="coursesList"></div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-gear" style="margin-right: 0.5rem; color: var(--primary);"></i>Settings</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Settings</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="ph ph-palette" style="margin-right: 0.5rem; color: var(--primary);"></i>Appearance</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Choose your preferred theme</p>
                        
                        <div style="display: grid; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" class="theme-option" data-theme="dark">
                                <input type="radio" name="theme" value="dark" style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">ðŸŒ™ Dark Mode</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Default dark theme with purple accents</div>
                                </div>
                            </label>

                            <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" class="theme-option" data-theme="midnight">
                                <input type="radio" name="theme" value="midnight" style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">ðŸŒŒ Midnight Mode</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Deeper blacks for OLED screens</div>
                                </div>
                            </label>

                            <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" class="theme-option" data-theme="light">
                                <input type="radio" name="theme" value="light" style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">â˜€ï¸ Light Mode</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Bright theme for daytime use</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title"><i class="ph ph-bell" style="margin-right: 0.5rem; color: var(--primary);"></i>Notifications</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Manage your notification preferences</p>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">Enable Notifications</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">Receive comedic reminders for due dates</div>
                            </div>
                            <label class="switch" style="position: relative; display: inline-block; width: 50px; height: 26px;">
                                <input type="checkbox" id="notifToggle" onchange="toggleNotifications(this.checked)" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border-color); transition: .4s; border-radius: 34px;"></span>
                                <span class="slider-knob" style="position: absolute; content: ''; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                                <style>
                                    input:checked + .slider { background-color: var(--primary); }
                                    input:focus + .slider { box-shadow: 0 0 1px var(--primary); }
                                    input:checked ~ .slider-knob { transform: translateX(24px); }
                                </style>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Google API & Chart.js -->
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="index.js"></script>
</body>
</html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#b66dff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WorkFlow">
    <link rel="apple-touch-icon" href="/icons/icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Login Page -->
    <div class="auth-page" id="loginPage">
        <div class="auth-card">
            <div class="sidebar-brand-icon" style="justify-content: center; margin-bottom: 1rem;">
                <img src="/icons/icon-192x192.png" alt="WorkFlow Logo" style="width: 60px; height: 60px;">
            </div>
            <h2>WorkFlow</h2>
            <p>Track Google Classroom assignments with AI assistance & productivity insights</p>
            
            <button class="btn btn-google" id="googleLoginBtn">
                <svg width="20" height="20" viewBox="0 0 20 20">
                    <path fill="#4285f4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"/>
                    <path fill="#34a853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"/>
                    <path fill="#fbbc05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"/>
                    <path fill="#ea4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"/>
                </svg>
                Sign in with Google Classroom
            </button>
            
            <div id="errorMsg" class="error" style="display: none; margin-top: 1rem;"></div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" style="display: none;">
        <div class="sidebar-backdrop" id="mobileBackdrop"></div>
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-brand">
                <span class="sidebar-brand-icon">
                    <img src="/icons/icon-192x192.png" alt="Logo" style="width: 32px; height: 32px;">
                </span>
                <span class="sidebar-brand-text">WorkFlow</span>
            </div>
            <div class="sidebar-menu">
                <a class="sidebar-menu-item active" onclick="showPage('assignments')">
                    <span class="sidebar-menu-icon"><i class="ph ph-clipboard-text"></i></span>
                    <span>Assignments</span>
                </a>
                <a class="sidebar-menu-item" onclick="showPage('statistics')">
                    <span class="sidebar-menu-icon"><i class="ph ph-chart-bar"></i></span>
                    <span>Statistics</span>
                </a>
                <a class="sidebar-menu-item" onclick="showPage('ai-assistant')">
                    <span class="sidebar-menu-icon"><i class="ph ph-magic-wand"></i></span>
                    <span>AI Assistant</span>
                </a>
                
                <div class="sidebar-section-label">Preferences</div>

                <a class="sidebar-menu-item" onclick="showPage('courses')">
                    <span class="sidebar-menu-icon"><i class="ph ph-books"></i></span>
                    <span>Courses</span>
                </a>
                <a class="sidebar-menu-item" onclick="showPage('settings')">
                    <span class="sidebar-menu-icon"><i class="ph ph-gear"></i></span>
                    <span>Settings</span>
                </a>

                <div class="sidebar-section-label">Help</div>

                <a class="sidebar-menu-item" onclick="showPage('help')">
                    <span class="sidebar-menu-icon"><i class="ph ph-question"></i></span>
                    <span>FAQ</span>
                </a>
            </div>
        </nav>

        <!-- Main Panel -->
        <div class="main-panel">
            <!-- Navbar -->
            <div class="navbar">
                <div class="navbar-left">
                    <button class="menu-toggle" id="mobileMenuBtn">‚ò∞</button>
                    <h4>Dashboard</h4>
                </div>
                <div class="navbar-right">
                    <div class="user-profile">
                        <div class="user-avatar"></div>
                        <div>
                            <div class="user-name">User</div>
                            <div class="badge">Connected</div>
                        </div>
                    </div>
                    <button class="btn btn-danger" id="logoutBtn" style="padding: 0.5rem 1rem;">Logout</button>
                </div>
            </div>

            <!-- Content -->
            <div class="content-wrapper">
                <!-- Assignments Page -->
                <div id="assignmentsPage">
                    <div id="notificationPermission" class="notification-permission" style="display: none;">
                        <div style="font-size: 1.5rem; color: var(--warning); display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                            <i class="ph ph-bell-ringing"></i>
                        </div>
                        <div style="flex: 1;">
                            <strong>Enable Notifications</strong>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0.25rem 0 0;">
                                Get comedic reminders when assignments are due soon!
                            </p>
                        </div>
                        <button class="btn btn-primary" onclick="requestNotificationPermission()">Enable</button>
                    </div>

                    <div class="page-header">
                        <h3>My Assignments</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Assignments</span>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <div class="stat-info">
                                <h3 id="totalCount">0</h3>
                                <div class="stat-label">Total Assignments</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-stack"></i></div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-info">
                                <h3 id="pendingCount">0</h3>
                                <div class="stat-label">Pending</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-hourglass"></i></div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-info">
                                <h3 id="lateCount">0</h3>
                                <div class="stat-label">Late</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-warning-circle"></i></div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-info">
                                <h3 id="dueToday">0</h3>
                                <div class="stat-label">Due Today</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-target"></i></div>
                        </div>
                    </div>

                    <div id="loadingMsg" class="loading" style="display: none;">
                        Loading assignments...
                    </div>

                    <div class="assignments-grid" id="assignmentsList"></div>
                </div>

                <!-- Statistics Page -->
                <div id="statisticsPage" style="display: none;">
                    <div class="page-header">
                        <h3>Statistics & Analytics</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Statistics</span>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card warning">
                            <div class="stat-info">
                                <h3 id="upcomingWeek">0</h3>
                                <div class="stat-label">Due This Week</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-calendar"></i></div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-info">
                                <h3 id="overdueTotal">0</h3>
                                <div class="stat-label">Total Overdue</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-siren"></i></div>
                        </div>
                        <div class="stat-card primary">
                            <div class="stat-info">
                                <h3 id="totalCourses">0</h3>
                                <div class="stat-label">Active Courses</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-books"></i></div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-info">
                                <h3 id="avgPerCourse">0</h3>
                                <div class="stat-label">Avg per Course</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-chart-line"></i></div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="card">
                            <div class="card-title">Assignment Status Distribution</div>
                            <canvas id="statusChart" style="max-height: 300px;"></canvas>
                        </div>

                        <div class="card">
                            <div class="card-title">Assignments by Course</div>
                            <canvas id="courseChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title"><i class="ph ph-calendar-check" style="margin-right: 0.5rem; color: var(--primary);"></i>Upcoming Deadlines (Next 7 Days)</div>
                        <div id="upcomingDeadlines" style="margin-top: 1rem;"></div>
                    </div>

                    <div class="page-header" style="margin-top: 3rem;">
                        <h3><i class="ph ph-trend-up" style="margin-right: 0.5rem; color: var(--primary);"></i>Your Productivity</h3>
                        <p style="color: var(--text-secondary);">Track your assignment completion over time</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-info">
                                <h3 id="completedToday">0</h3>
                                <div class="stat-label">Completed Today</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-check-circle"></i></div>
                        </div>
                        <div class="stat-card streak">
                            <div class="stat-info">
                                <h3 id="currentStreak">0</h3>
                                <div class="stat-label">Day Streak</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-fire"></i></div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-info">
                                <h3 id="weeklyAvg">0</h3>
                                <div class="stat-label">Weekly Average</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-chart-bar"></i></div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-info">
                                <h3 id="totalCompleted">0</h3>
                                <div class="stat-label">Total Completed</div>
                            </div>
                            <div class="stat-icon"><i class="ph ph-trophy"></i></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title"><i class="ph ph-chart-line-up" style="margin-right: 0.5rem; color: var(--primary);"></i>Productivity Trends</div>
                        <div class="time-selector">
                            <button class="time-btn active" onclick="changeProductivityView('today')" data-view="today">Today</button>
                            <button class="time-btn" onclick="changeProductivityView('week')" data-view="week">7 Days</button>
                            <button class="time-btn" onclick="changeProductivityView('month')" data-view="month">30 Days</button>
                        </div>
                        <canvas id="productivityChart" style="max-height: 350px;"></canvas>
                    </div>
                </div>

                <!-- AI Assistant Page -->
                <div id="aiAssistantPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-magic-wand" style="margin-right: 0.5rem; color: var(--primary);"></i>AI Study Assistant</h3>
                        <p style="color: var(--text-secondary);">
                            Chat with AI about your assignments, get study tips, and manage your workload better!
                        </p>
                    </div>

                    <div id="chatInterface" style="display: none;">
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <div class="chat-message">
                                    <div class="chat-avatar">
                                        <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" version="1.1" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" style="width: 24px; height: 24px;">
                                            <rect height="7.5" width="12.5" y="5.75" x="1.75"></rect> 
                                            <path d="m10.75 8.75v1.5m-5.5-1.5v1.5m-.5-7.5 3.25 3 3.25-3"></path> 
                                        </svg>
                                    </div>
                                    <div class="chat-content">
                                        Hi! I'm your AI study assistant. I can see you have <strong id="aiPendingCount">0</strong> pending assignments. How can I help you today?
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <textarea id="chatInput" class="chat-input" rows="2" placeholder="Ask me anything about your assignments..."></textarea>
                                <button class="btn btn-primary" onclick="sendChatMessage()" style="padding: 1rem 1.5rem;">Send</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help & FAQ Page -->
                <div id="helpPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-question" style="margin-right: 0.5rem; color: var(--primary);"></i>Help & FAQ</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Help</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Frequently Asked Questions</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Find answers to common questions below.</p>
                        
                        <!-- Accordion -->
                        <div class="accordion">
                            <div class="accordion-item">
                                <div class="accordion-header" onclick="toggleAccordion(this)">
                                    <span>Cannot install app</span>
                                    <i class="ph ph-caret-down accordion-icon"></i>
                                </div>
                                <div class="accordion-content">
                                    <p style="margin-bottom: 1rem;">
                                        Apple's iOS security policies restrict the installation of Progressive Web Apps (PWAs) from third-party browsers. This feature is fully supported on Android and desktop Chrome, but requires specific steps on iOS.
                                    </p>
                                    <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Solutions:</h5>
                                    <ul style="padding-left: 1.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                                        <li>
                                            <strong>Use Safari:</strong> Open this page in Safari, tap the <strong>Share</strong> button (square with arrow), and select <strong>"Add to Home Screen"</strong>.
                                        </li>
                                        <li>
                                            <strong>Continue in Browser:</strong> You can continue using the application directly within your current web browser without installing it.
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Courses Page -->
                <div id="coursesPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-books" style="margin-right: 0.5rem; color: var(--primary);"></i>My Courses</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Courses</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">Manage Your Courses</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Uncheck courses you want to ignore. They won't appear in assignments or statistics.</p>
                        <div id="coursesList"></div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="ph ph-gear" style="margin-right: 0.5rem; color: var(--primary);"></i>Settings</h3>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span>/</span>
                            <span>Settings</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="ph ph-palette" style="margin-right: 0.5rem; color: var(--primary);"></i>Appearance</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Choose your preferred theme</p>
                        
                        <div style="display: grid; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" class="theme-option" data-theme="dark">
                                <input type="radio" name="theme" value="dark" style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">üåô Dark Mode</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Default dark theme with purple accents</div>
                                </div>
                            </label>

                            <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" class="theme-option" data-theme="midnight">
                                <input type="radio" name="theme" value="midnight" style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">üåå Midnight Mode</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Deeper blacks for OLED screens</div>
                                </div>
                            </label>

                            <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" class="theme-option" data-theme="light">
                                <input type="radio" name="theme" value="light" style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">‚òÄÔ∏è Light Mode</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Bright theme for daytime use</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title"><i class="ph ph-bell" style="margin-right: 0.5rem; color: var(--primary);"></i>Notifications</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Manage your notification preferences</p>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: rgba(182, 109, 255, 0.05); border-radius: 8px;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">Enable Notifications</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">Receive comedic reminders for due dates</div>
                            </div>
                            <label class="switch" style="position: relative; display: inline-block; width: 50px; height: 26px;">
                                <input type="checkbox" id="notifToggle" onchange="toggleNotifications(this.checked)" style="opacity: 0; width: 0; height: 0;">
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border-color); transition: .4s; border-radius: 34px;"></span>
                                <span class="slider-knob" style="position: absolute; content: ''; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                                <style>
                                    input:checked + .slider { background-color: var(--primary); }
                                    input:focus + .slider { box-shadow: 0 0 1px var(--primary); }
                                    input:checked ~ .slider-knob { transform: translateX(24px); }
                                </style>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Google API & Chart.js -->
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="index.js" defer></script>
</body>
</html